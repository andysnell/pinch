includes:
    - phar://phpstan.phar/conf/bleedingEdge.neon
    - packages/phpstan/config/architecture.neon

parameters:
    level: 8

    tmpDir: build/phpstan

    paths:
        - packages/component
        - packages/core
        - packages/framework
        - packages/phpstan/config
        - packages/phpstan/src
        - packages/template/bin
        - packages/template/config
        - packages/template/public
        - packages/template/src
        - packages/template/tests

    dynamicConstantNames:
        - PhoneBurner\Pinch\Framework\APP_ROOT

    ignoreErrors:
        - identifier: missingType.iterableValue
        - identifier: staticMethod.alreadyNarrowedType
        - identifier: function.alreadyNarrowedType
        - identifier: method.internalClass
        - identifier: new.internalClass

        # Temporarily ignoring these errors until converting to a monorepo is complete
        - identifier: possiblyImpure.methodCall
          path: packages/core/src/Uuid/UuidWrapper.php

        # Possible PHPStan Bug:
        - identifier: deadCode.unreachable
          path: packages/framework/src/bootstrap.php

        # Testing Allowances
        - identifier: function.impossibleType
          path: packages/core/tests/Type/TypeFunctionsTest.php
        - identifier: function.impossibleType
          path: packages/core/tests/String/StringFunctionsTest.php
        - identifier: staticMethod.impossibleType
          path: packages/core/tests/Type/ReflectTest.php

    treatPhpDocTypesAsCertain: false

    # Strict Analysis
    # https://phpstan.org/config-reference#stricter-analysis
    checkDynamicProperties: true
    checkExplicitMixedMissingReturn: true
    checkFunctionNameCase: true
    checkImplicitMixed: false
    checkInternalClassCaseSensitivity: true
    checkTooWideReturnTypesInProtectedAndPublicMethods: true
    checkUninitializedProperties: true
    reportMaybesInMethodSignatures: true
    reportMaybesInPropertyPhpDocTypes: true
    reportStaticMethodSignatures: true
    reportUnmatchedIgnoredErrors: false
    reportPossiblyNonexistentGeneralArrayOffset: false
    reportPossiblyNonexistentConstantArrayOffset: false
    reportAlwaysTrueInLastCondition: false
    reportWrongPhpDocTypeInVarTag: false
    reportAnyTypeWideningInVarTag: false
    checkMissingOverrideMethodAttribute: false # update to true when Rector supports improves

    # Extension: Disallowed Calls For PHPStan
    # https://github.com/spaze/phpstan-disallowed-calls
    disallowedConstants:
        - class: 'DateTimeInterface'
          constant: 'ISO8601'
          message: 'use DateTimeInterface::ATOM instead'

    disallowedNamespaces:
        - namespace: '\DateTime'
          message: 'Use DateTimeImmutable instead'
          allowIn:
            - '*/tests/unit/Module/Telephony/Router/ReservationTest.php'

        - namespace: \Carbon\Carbon
          message: 'Use \Carbon\CarbonImmutable instead'
          allowIn:
            - '*/tests/unit/TestSupport/TimeStopper.php'
            - '*/tests/unit/TestSupport/ResetCarbonTestNowAfterTests.php'
            - '*/tests/unit/TestSupport/ResetCarbonTestNowBeforeClass.php'

    disallowedFunctionCalls:
        - function: 'var_dump()'
        - function: 'dd()'
        - function: 'phpinfo()'
        - function: 'die()'
        - function: 'exit()'
        - function: 'uniqid()'
        - function: 'rand()'
        - function: 'mt_rand()'
